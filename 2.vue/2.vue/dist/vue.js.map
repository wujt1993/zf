{"version":3,"file":"vue.js","sources":["../src/complier/generate.js","../src/complier/parse.js","../src/complier/index.js","../src/util.js","../src/global-api/index.js","../src/observer/dep.js","../src/observer/schedular.js","../src/observer/watcher.js","../src/vdom/index.js","../src/vdom/patch.js","../src/lifecycle.js","../src/observer/array.js","../src/observer/index.js","../src/state.js","../src/init.js","../src/render.js","../src/index.js"],"sourcesContent":["const defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g\r\n\r\nfunction genProps(attrs) {\r\n    let str = '';\r\n    for(let i = 0; i < attrs.length; i++) {\r\n        let attr = attrs[i];\r\n        if(attr.name==\"style\") {\r\n            let obj = {};\r\n            attr.value.split(';').forEach(item => {\r\n                if(item) {\r\n                    let [key, value] = item.split(':');\r\n                    obj[key] = value\r\n                }\r\n            });\r\n            attr.value = obj\r\n        }\r\n\r\n        str += `${attr.name}:${JSON.stringify(attr.value)},`\r\n    }\r\n    return `{${str.slice(0,-1)}}`\r\n}\r\nfunction gen(node) {\r\n    if(node.type == 1) {\r\n        return generate(node)\r\n    }else {\r\n        let text = node.text;\r\n        if(defaultTagRE.test(text)) {\r\n            let tokens = [];\r\n            let match ;\r\n            let index = 0;\r\n            let lastIndex = defaultTagRE.lastIndex = 0;\r\n            while(match = defaultTagRE.exec(text)){ // aa {{ age }} haha \r\n                index = match.index;\r\n                if(index >lastIndex){\r\n                    tokens.push(JSON.stringify(text.slice(lastIndex,index)));\r\n                }\r\n                tokens.push(`_s(${match[1].trim()})`);\r\n                lastIndex = index + match[0].length;\r\n            }\r\n            if(lastIndex < text.length){\r\n                tokens.push(JSON.stringify(text.slice(lastIndex)))\r\n            }\r\n            return  `_v(${tokens.join('+')})`\r\n        }else {\r\n            return `_v(${JSON.stringify(text)})`\r\n        }\r\n    }\r\n}\r\n\r\nfunction genChildren(el) {\r\n    const children  = el.children;\r\n    if(children){\r\n        return children.map(child=>gen(child)).join(',')\r\n    }\r\n}\r\nexport function generate(el) {\r\n    let children = genChildren(el);\r\n    let code = `_c('${el.tag}',${el.attrs.length!=0?genProps(el.attrs):'undefined'}${children?','+children:''})`;\r\n    return code;   \r\n}\r\n\r\n/**\r\n * 将字符串 转成可运行的js\r\n * <div id=\"app\" a=1 b =\"2\">\r\n *    hello \r\n *    <div style=\"color: red\">\r\n *         <span>! {{ name}} !</span>\r\n *    </div>\r\n * </div>\r\n * _c('div',{id:'app',a:1,b:'2'},\r\n *      _v(\"hello\"),\r\n *      _c('div', {style:{color: 'red}}, \r\n *          _c('span',undefined, \r\n *              _v('!' + _s(name) + '!')\r\n *          )\r\n *      )\r\n * )\r\n */","\r\nconst ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`; // aa-aa \r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`; //aa:aa\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // 可以匹配到标签名  [1]\r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); //[0] 标签的结束名字\r\n//    style=\"xxx\"   style='xxx'  style=xxx\r\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;\r\nconst startTagClose = /^\\s*(\\/?)>/;\r\n\r\n\r\nexport function parseHTML(html) {\r\n    let root;\r\n    let currentParent;\r\n    let stack = []\r\n\r\n\r\n    function createASTElement(tag, attrs) {\r\n        return {\r\n            tag,\r\n            attrs,\r\n            type: 1,\r\n            children: [],\r\n            parent: null\r\n        }\r\n\r\n    }\r\n\r\n\r\n    function start(tagName, attrs) {\r\n        let node = createASTElement(tagName, attrs);\r\n        if(root == null) {\r\n            root = node;\r\n        }\r\n        currentParent = node;\r\n        stack.push(node);\r\n    }\r\n\r\n    function end(tagName) {\r\n        let node = stack.pop();\r\n        if(node.tag != tagName) {\r\n            throw Error(\"解析报错\");\r\n        }\r\n\r\n        currentParent = stack[stack.length - 1];\r\n        if(currentParent) {\r\n            node.parent = currentParent;\r\n            currentParent.children.push(node);\r\n        }\r\n    }\r\n\r\n    function chars(text) {\r\n        text = text.replace(/\\s/g,\"\");\r\n        if(text) {\r\n            currentParent.children.push({\r\n                text,\r\n                type: 3\r\n            })\r\n        }\r\n    }\r\n\r\n    function advance(n) {\r\n        html = html.substring(n)\r\n    }\r\n\r\n    function parseStartTag() {\r\n        let start = html.match(startTagOpen);\r\n        if(start) {\r\n            let match = {\r\n                tagName: start[1],\r\n                attrs: []\r\n            }\r\n            advance(start[0].length);\r\n\r\n            let end, attr;\r\n            while(!(end=html.match(startTagClose)) && (attr = html.match(attribute))) {\r\n                match.attrs.push({\r\n                    name: attr[1],\r\n                    value: attr[3] || attr[4] || attr[5] || true\r\n                })\r\n                advance(attr[0].length)\r\n            }\r\n            if(end) {\r\n                advance(end[0].length)\r\n                return match\r\n            }\r\n            \r\n        }\r\n\r\n    }\r\n\r\n    while(html) {\r\n        let textEnd = html.indexOf(\"<\");\r\n        if(textEnd == 0) {//标签\r\n            let startTagMatch = parseStartTag();\r\n            if(startTagMatch) {\r\n                start(startTagMatch.tagName, startTagMatch.attrs)\r\n                continue\r\n            }\r\n\r\n            let endTagMatch = html.match(endTag);\r\n            if(endTagMatch) {\r\n                advance(endTagMatch[0].length);\r\n                end(endTagMatch[1]);\r\n                continue;\r\n            }\r\n\r\n\r\n        }\r\n        if(textEnd > 0) {//文本\r\n            let text = html.substring(0, textEnd);\r\n            advance(text.length);\r\n            chars(text);\r\n        }\r\n    }\r\n    return root;\r\n}","import { generate } from \"./generate.js\";\r\nimport { parseHTML } from \"./parse.js\";\r\nexport function compileToFunctions(template) {\r\n    //获取ast树\r\n    let ast = parseHTML(template);\r\n    \r\n    //获得可运行的render函数\r\n    let code = generate(ast);\r\n    let render = `with(this){return ${code}}`\r\n    let fn = new Function(render);\r\n    return fn\r\n}\r\n\r\n// function a(){\r\n//     with(this) {\r\n//         console.log(b)\r\n//     }\r\n// }\r\n// a.call({b:1}) // 1","let callbacks = [];\r\nlet waiting = false;\r\n\r\nfunction flushCallbacks() {\r\n    for(let i = 0; i <callbacks.length;i++){\r\n        let callback = callbacks[i];\r\n        callback();\r\n    }\r\n    waiting = false;\r\n    callbacks = [];\r\n}\r\n\r\nexport function nextTick(cb) {\r\n    callbacks.push(cb);\r\n    if(!waiting) {\r\n        waiting = true;\r\n         // 1.promise先看支持不支持 \r\n        // 2.mutationObserver\r\n        // 3.setImmdiate\r\n        // 4.setTimeout  Vue3 next-tick就直接用了promise\r\n        return Promise.resolve().then(flushCallbacks)\r\n    }\r\n}\r\n\r\n//vue 的生命周期函数\r\nlet strats = {}\r\nlet LIFECYCLE_HOOKS = [\r\n    'beforeCreate',\r\n    'created',\r\n    'beforeMount',\r\n    'mounted',\r\n    //....\r\n]\r\nfunction mergeHook(parentVal, childVal) {\r\n    if(childVal) {\r\n        if(parentVal) {\r\n            return parentVal.concat(childVal)\r\n        }else {\r\n            return [childVal]\r\n        }\r\n    }else {\r\n        return parentVal\r\n    }\r\n    \r\n}\r\nLIFECYCLE_HOOKS.forEach(hook=>{\r\n    strats[hook] = mergeHook;\r\n})\r\n\r\nstrats.components = function(parentVal, childVal) {\r\n    const res = Object.create(parentVal);\r\n    if (childVal) {\r\n        for (let key in childVal) {\r\n            res[key] = childVal[key];\r\n        }\r\n    }\r\n    return res;\r\n}\r\n\r\nexport function isObject(val) {\r\n    return typeof val === 'object' &&  val !== null;\r\n}\r\n\r\n\r\nexport function mergeOptions(parent, child) {\r\n    let options = {};\r\n    for(let key in parent) {\r\n        mergeField(key);\r\n    }\r\n\r\n    for(let key in child) {\r\n        if(parent.hasOwnProperty(key)) continue;\r\n        mergeField(key);\r\n    }\r\n\r\n    function mergeField(key) {\r\n        if(strats[key]) {\r\n            return options[key] = strats[key](parent[key], child[key]);\r\n        }\r\n        if(isObject(parent[key])) {\r\n            options[key] = {...parent[key], ...child[key]}\r\n        }else{\r\n            if(child[key]) {\r\n                options[key] = child[key]\r\n            }else {\r\n                options[key] = parent[key]\r\n            }\r\n        }\r\n        \r\n    }\r\n\r\n    return options;\r\n}\r\n\r\nfunction makeUp(str) {\r\n    let map = {}\r\n    str.split(\",\").forEach(item=>{\r\n        map[item] = true\r\n    })\r\n    return (tag) => map[tag] || false\r\n}\r\n\r\nexport const isReservedTag = makeUp('div,ul,li,p,h1,h2,h3,h4,h5,h6,table,input,button,em,i,span,a');","\r\nimport {mergeOptions}  from \"../util\"\r\n\r\nexport function initGlobalAPI(Vue) {\r\n\r\n    Vue.options = {}\r\n\r\n    Vue.mixin = function(mixin) {\r\n        this.options =  mergeOptions(this.options, mixin);\r\n        return this;\r\n    }\r\n\r\n    Vue.options._base = Vue;\r\n    Vue.options.components = {}\r\n\r\n    Vue.component = function(id, definition) {\r\n        definition.name = definition.name || id;\r\n        definition = this.options._base.extend(definition);\r\n        Vue.options.components[id] = definition;\r\n    }\r\n    let cid = 0\r\n    Vue.extend = function(options) {\r\n        const Super = this;\r\n        const Sub = function VueComponent(options) {\r\n            this._init(options);\r\n        }\r\n        Sub.cid = cid++;\r\n        Sub.prototype = Object.create(Super.prototype);\r\n        Sub.prototype.constructor = Sub;\r\n        Sub.component = Super.component;\r\n        Sub.options = mergeOptions(Super.options, options)\r\n        return Sub;\r\n    }\r\n}","\r\nlet id = 0;\r\n\r\nclass Dep{\r\n    constructor() {\r\n        this.id = id++;\r\n        this.subs = []\r\n    }\r\n\r\n    depend() {\r\n        Dep.target.addDep(this); //让每个watcher 记住dep\r\n    }\r\n\r\n    addSub(watcher) {\r\n        this.subs.push(watcher)\r\n    }\r\n\r\n    notify() {\r\n        this.subs.forEach(watcher=>{\r\n            watcher.update()\r\n        })\r\n    }\r\n}\r\n\r\nDep.target = null;\r\n\r\nexport function pushTarget(watcher) {\r\n    Dep.target = watcher\r\n}\r\n\r\nexport function popTarget() {\r\n    Dep.target = null;\r\n}\r\n\r\n\r\nexport default Dep;","import { nextTick } from \"../util\";\r\n\r\nlet has = {};\r\nlet queue = [];\r\nlet pending = false\r\nfunction flushSchedularQueue() {\r\n    for(let i = 0; i < queue.length; i++) {\r\n        let watcher = queue[i];\r\n        watcher.run();\r\n    }\r\n    has = {};\r\n    queue = [];\r\n    pending = false;\r\n}\r\nexport function queueWatcher(watcher){\r\n    let id = watcher.id;\r\n    if(!has[id]) {\r\n        has[id] = true;\r\n        queue.push(watcher);\r\n        if(!pending) {\r\n            pending = true;\r\n            nextTick(flushSchedularQueue)\r\n        }\r\n    }\r\n\r\n}","import Dep, { popTarget, pushTarget } from \"./dep\";\r\nimport { queueWatcher } from \"./schedular\";\r\n\r\nlet id = 0;\r\nclass Watcher{\r\n    constructor(vm, exprOrFn, cb, options) {\r\n        this.vm = vm;\r\n        this.cb = cb;\r\n        this.options = options;\r\n        this.id = id++;\r\n        this.getter = exprOrFn;\r\n        this.deps = [];\r\n        this.depsId = new Set();\r\n        this.get(); // 调用传入的函数， 调用了render方法， 此时会对模板中的数据进行取值\r\n    }\r\n\r\n    get() {\r\n        //当页面渲染时，注册一个watcher\r\n        pushTarget(this);\r\n        this.getter();\r\n        popTarget();\r\n    }\r\n\r\n    addDep(dep) {\r\n        let id = dep.id;\r\n        if(!this.depsId.has(id)) {\r\n            this.deps.push(dep);\r\n            this.depsId.add(id);\r\n            dep.addSub(this);\r\n        }\r\n    }\r\n\r\n    run() {\r\n        this.get()\r\n    }\r\n    update() {\r\n        queueWatcher(this);\r\n    }\r\n}\r\n\r\nexport default Watcher;","import { isObject, isReservedTag } from \"../util\"\r\n\r\n//创建虚拟节点\r\nexport function createElement(vm, tag, data={}, ...children){\r\n    if(isReservedTag(tag)){\r\n        return vnode(vm,tag,data, data.key,children, undefined)\r\n    }else {\r\n        const Ctor = vm.$options.components[tag];\r\n        return createComponent(vm,tag,data, data.key,children, undefined, Ctor)\r\n    }\r\n    \r\n}\r\nfunction createComponent(vm,tag,data, key,children, text, Ctor) {\r\n    if(isObject(Ctor)) {\r\n        Ctor = vm.$options._base.extend(Ctor);\r\n    }\r\n    data.hook = {\r\n        init(vnode) {\r\n            // 调用子组件的构造函数\r\n            let child = vnode.componentInstance = new vnode.componentOptions.Ctor({});\r\n            child.$mounted(); // 手动挂在  vnode.componentInstance.$el = 真实的元素\r\n        }\r\n    }\r\n\r\n    return vnode(vm,`vue-compontent-${Ctor.cid}-${tag}`,data, key,undefined, undefined, {Ctor})\r\n\r\n\r\n}\r\nexport function createTextVnode(vm, text) {\r\n    return vnode(vm, undefined, undefined, undefined, undefined, text)\r\n}\r\n\r\nfunction vnode(vm, tag, data, key,children, text, componentOptions) {\r\n    return {\r\n        vm, \r\n        tag,\r\n        data,\r\n        key,\r\n        children,\r\n        text,\r\n        componentOptions\r\n    }\r\n}\r\n\r\nexport function isSameVnode(oldVnode, newVNode) {\r\n    return (oldVnode.tag === newVNode.tag) && (oldVnode.key === newVNode.key)\r\n}","\r\nimport {isSameVnode} from './index'\r\n\r\nexport function patch(oldVnode, vnode) {\r\n    // oldVnode 是一个真实的元素\r\n    //1、组件\r\n    if(!oldVnode){\r\n        return createElm(vnode); // 根据虚拟节点创建元素\r\n    }\r\n\r\n    \r\n    const isRealElement = oldVnode.nodeType\r\n    //2、初次渲染\r\n    if (isRealElement) {\r\n        // 初次渲染\r\n        const oldElm = oldVnode; // id=\"app\"\r\n        const parentElm = oldElm.parentNode; // body\r\n        let el = createElm(vnode);\r\n        parentElm.insertBefore(el, oldElm.nextSibling); // 将创建的节点查到原有的节点的下一个\r\n        parentElm.removeChild(oldElm);\r\n        return el; // vm.$el\r\n    } else {\r\n        //3、数据更新渲染\r\n        // diff算法\r\n        //1、当标签名不同，直接将旧的元素替换成新的元素\r\n        if(oldVnode.tag !== vnode.tag) {\r\n            return oldVnode.el.parentElement.replaceChild(createElm(vnode), oldVnode.el);\r\n        }\r\n\r\n        //2、标签一样，但文本不一样\r\n        if(!oldVnode.tag) {\r\n            if(oldVnode.text !== vnode.text) {\r\n                oldVnode.el.textContent = vnode.text;\r\n            }\r\n        }\r\n\r\n        //3、属性不一样\r\n        let el = vnode.el = oldVnode.el;\r\n        updateProperties(vnode, oldVnode.data);\r\n\r\n        //4、更新子元素\r\n        let oldChildren = oldVnode.children || [];\r\n        let newChildren = vnode.children || [];\r\n\r\n        if(oldChildren.length > 0 && newChildren.length > 0) {\r\n            updateChildren(el, oldChildren, newChildren);\r\n        }else if(oldChildren.length > 0) {\r\n            oldVnode.el.innerHTML = \"\";\r\n        }else if(newChildren.length > 0) {\r\n            newChildren.forEach(child => {\r\n                oldVnode.el.appendChild(createElm(child))\r\n            })\r\n        }\r\n    }\r\n}\r\n\r\nfunction updateChildren(parent, oldChildren, newChildren) {\r\n    let oldStartIndex = 0;\r\n    let oldEndInex = oldChildren.length - 1;\r\n    let oldStartVnode =  oldChildren[oldStartIndex];\r\n    let oldEndVnode = oldChildren[oldEndInex];\r\n\r\n    let newStartIndex = 0;\r\n    let newEndIndex = newChildren.length - 1;\r\n    let newStartVnode =  newChildren[newStartIndex];\r\n    let newEndVnode = newChildren[newEndIndex];\r\n\r\n    let map = makeIndexByKey(oldChildren);\r\n    function makeIndexByKey(oldChildren) {\r\n        let map = {};\r\n        oldChildren.forEach((item, index) => {\r\n            map[item.key] = index \r\n        });\r\n        return map;\r\n    }\r\n\r\n    while(oldStartIndex <= oldEndInex && newStartIndex <= newEndIndex) {\r\n        if(!oldStartVnode){\r\n            oldStartVnode = oldChildren[++oldStartIndex]\r\n        }else if(!oldEndVnode){\r\n            oldEndVnode = oldChildren[--oldEndIndex];\r\n        }else if(isSameVnode(oldStartVnode, newStartVnode)) {//新的头指针和旧的头指针相同，头指针加一\r\n            patch(oldStartVnode, newStartVnode);\r\n            oldStartVnode = oldChildren[++oldStartIndex];\r\n            newStartVnode = newChildren[++newStartIndex];\r\n        }else if(isSameVnode(oldEndVnode, newEndVnode)) {//新的尾指针指针和旧的尾指针相同，尾指针减一\r\n            patch(oldEndVnode, newEndVnode);\r\n            oldEndVnode = oldChildren[--oldEndInex];\r\n            newEndVnode = newChildren[--newEndIndex];\r\n        }else if(isSameVnode(oldStartVnode, newEndVnode)) {//旧的头指针和新的尾指针相同，旧的头指针加一，新的尾指针减一，将旧的头指针元素移动到旧的尾指针的元素后面\r\n            patch(oldStartVnode, newEndVnode);\r\n            parent.insertBefore(oldStartVnode.el,oldEndVnode.el.nextSibling);\r\n            oldStartVnode = oldChildren[++oldStartIndex];\r\n            newEndVnode = newChildren[--newEndIndex];\r\n        }else if(isSameVnode(oldEndVnode, newStartVnode)) {//旧的尾指针和新的头指针相同，旧的尾指针减一，新的头指针加一，将旧的尾指针元素移动到旧的头指针的元素前面\r\n            patch(oldStartVnode, newEndVnode);\r\n            parent.insertBefore(oldStartVnode.el,oldEndVnode.el.nextSibling);\r\n            oldStartVnode = oldChildren[++oldStartIndex];\r\n            newEndVnode = newChildren[--newEndIndex];\r\n        }else {\r\n            let moveIndex = map[newStartVnode.key];\r\n            if(!moveIndex) {\r\n                parent.insertBefore(createElm(newStartVnode),oldStartVnode.el);\r\n            }else {\r\n                let moveVnode = oldChildren[moveIndex];\r\n                oldChildren[moveIndex] = undefined;\r\n                patch(moveVnode,newStartVnode); // 如果找到了 需要两个虚拟节点比对\r\n                parent.insertBefore(moveVnode.el,oldStartVnode.el)\r\n            }\r\n            newStartVnode = newChildren[++newStartIndex];\r\n        }\r\n    }\r\n    for(let i = oldStartIndex; i <= oldEndInex; i++) {\r\n        let child  = oldChildren[i];\r\n        if(child) {\r\n            parent.removeChild(child.el)\r\n        }\r\n    }\r\n\r\n    for(let i = newStartIndex; i <= newEndIndex; i++) {\r\n        // 向前插入 向后插入\r\n        // 看一眼newEndIndex 下一个节点有没有值\r\n        let nextEle = newChildren[newEndIndex+1] == null? null:  newChildren[newEndIndex+1].el;\r\n        // appendChild 和 insertBefore 也可以进行合并\r\n        // 如果insertBefore 传入null 等价于appendChild\r\n        parent.insertBefore(createElm(newChildren[i]),nextEle)\r\n        // parent.appendChild(createElm(newChildren[i]));\r\n    }\r\n}\r\n\r\n\r\nexport function createComponent(vnode) {\r\n    let i = vnode.data;\r\n    if((i = i.hook) && (i = i.init)){\r\n        i(vnode)\r\n    }\r\n    if(vnode.componentInstance){ // 如果虚拟节点上有组件的实例说明当前这个vode是组件\r\n        return true;\r\n    }\r\n    return false\r\n}\r\n\r\nexport function createElm(vnode) { // 根据虚拟节点创建真实的节点\r\n    let { tag, children, key, data, text, vm } = vnode;\r\n    if(typeof tag === 'string'){\r\n        // 可能是组件\r\n        if(createComponent(vnode)){\r\n            // 如果返回true 说明这个虚拟节点是组件\r\n            // 如果是组件，就将组件渲染后的真实元素给我\r\n            return vnode.componentInstance.$el\r\n        }\r\n        vnode.el =  document.createElement(tag); // 用vue的指令时 可以通过vnode拿到真实dom\r\n        updateProperties(vnode);\r\n        children.forEach(child=>{ // 如果有儿子节点，就进行递归操作\r\n           vnode.el.appendChild(createElm(child))\r\n        })\r\n    }else{\r\n        vnode.el = document.createTextNode(text)\r\n    }\r\n\r\n    return vnode.el;\r\n}\r\nfunction updateProperties(vnode, oldProps = {}){\r\n    let newProps = vnode.data || {}; // 属性\r\n    let el = vnode.el; // dom元素\r\n    for(let key in oldProps) {\r\n        if (!newProps[key]) {\r\n            el.removeAttribute(key);\r\n        }\r\n    }\r\n\r\n    let newStyle = newProps.style || {}; // {color:blue}\r\n    let oldStyle = oldProps.style || {} // {background:red}\r\n    for (let key in oldStyle) { // 判断样式根据 新老先比对一下\r\n        if (!newStyle[key]) {\r\n            el.style[key] = ''\r\n        }\r\n    }\r\n    for(let key in newProps){\r\n        if(key == 'style'){\r\n            for(let styleName in newProps.style){\r\n                el.style[styleName] = newProps.style[styleName]\r\n            }\r\n        }else if(key === 'class'){\r\n            el.className = newProps.class\r\n        }else{\r\n            el.setAttribute(key,newProps[key]);\r\n        }\r\n    }\r\n}","import Watcher from \"./observer/watcher\"\r\nimport { patch } from './vdom/patch'\r\n\r\nexport function lifecycleMixin(Vue) {\r\n    Vue.prototype._update = function (vnode) {\r\n        const vm = this;\r\n        // 第一次初始化 第二次走diff算法\r\n        const prevVnode = vm._vnode; // 先取上一次的vnode 看一下是否有\r\n        vm._vnode = vnode // 保存上一次的虚拟节点\r\n        if (!prevVnode) {\r\n            vm.$el = patch(vm.$el, vnode); // 组件调用patch方法会产生$el属性\r\n        } else {\r\n            vm.$el = patch(prevVnode, vnode);\r\n        }\r\n    }\r\n}\r\n\r\nexport function callHook(vm, hook) {\r\n    let handlers = vm.$options[hook];\r\n    if (handlers) {\r\n        handlers.forEach(handler => {\r\n            handler.call(vm)\r\n        })\r\n    }\r\n\r\n}\r\n\r\n//组件挂载\r\nexport function mountComponent(vm) {\r\n    // 默认vue是通过watcher来进行渲染  = 渲染watcher （每一个组件都有一个渲染watcher）\r\n    let updateComponent = () => {\r\n        let vnode = vm._render();//生成虚拟节点\r\n\r\n        vm._update(vnode);//将虚拟节点转为真实节点\r\n    }\r\n\r\n    new Watcher(vm, updateComponent, () => { }, true); // updateComponent();\r\n\r\n}","let oldArrayMethods = Array.prototype;\r\n\r\nexport let arrayMethods = Object.create(Array.prototype);\r\n\r\nlet methods = [\r\n    'push',\r\n    'pop',\r\n    'unshift',\r\n    'shift',\r\n    'splice',\r\n    'reserve',\r\n    'sort'\r\n]\r\n\r\nmethods.forEach(method=> {\r\n    arrayMethods[method] = function(...args) {\r\n        let res = oldArrayMethods[method].call(this, ...args);\r\n        \r\n        let ob = this.__ob__;\r\n        let inserted;\r\n        switch (method) {\r\n            case 'push':\r\n            case 'unshift':\r\n                inserted = args;    \r\n                break;\r\n            case 'splice':\r\n                inserted = args.slice(2)\r\n        }\r\n        // console.log(`调用了数组${method}方法`);\r\n        if(inserted) ob.observeArray(inserted);\r\n        ob.dep.notify();\r\n        return res;\r\n    }\r\n})\r\n","import { arrayMethods } from \"./array\";\r\nimport Dep from \"./dep\";\r\n\r\nclass Observer{\r\n    constructor(value) {\r\n        Object.defineProperty(value, \"__ob__\", {\r\n            configurable: false,\r\n            enumerable: false,\r\n            value: this,\r\n        })\r\n        this.dep = new Dep(); // 给数组本身和对象本身增加一个dep属性\r\n        if(Array.isArray(value)) {\r\n            //监听删除、添加、排序、反转元素的方法\r\n            Object.setPrototypeOf(value, arrayMethods)\r\n            this.observeArray(value);\r\n        }else{\r\n            this.walk(value);\r\n        }\r\n        \r\n    }\r\n\r\n    observeArray(value) {\r\n        for(let i = 0, len = value.length; i < len; i++) {\r\n            observe(value[i]);\r\n        }\r\n    }\r\n\r\n    walk(data) {\r\n        Object.keys(data).forEach(key=>{\r\n            defineReactive(data, key, data[key])\r\n        })\r\n    }\r\n}\r\nfunction dependArray(value){ // 就是让里层数组收集外层数组的依赖，这样修改里层数组也可以更新视图 \r\n    for(let i = 0 ; i < value.length;i++){\r\n        let current = value[i];\r\n        current.__ob__ && current.__ob__.dep.depend(); // 让里层的和外层收集的都是同一个watcher\r\n        if(Array.isArray(current)){\r\n            dependArray(current);\r\n        }\r\n    }\r\n}\r\n\r\nfunction defineReactive(data, key, value) {\r\n    let childOb = observe(value);\r\n    let dep = new Dep(); // 每次都会给属性创建一个dep\r\n    Object.defineProperty(data, key, {\r\n        get() {\r\n            if(Dep.target){\r\n                dep.depend();// 让这个属性自己的dep记住这个watcher，也要让watcher记住这个dep\r\n                if(childOb){ // 如果对数组取值 会将当前的watcher和数组进行关联\r\n                    childOb.dep.depend();\r\n                    if(Array.isArray(value)){\r\n                        dependArray(value);\r\n                    }\r\n                }\r\n                \r\n            }\r\n            return value\r\n        },\r\n        set(newValue) {\r\n            if(newValue === value) return;\r\n            value = newValue;\r\n            observe(newValue);\r\n            dep.notify();// 通知dep中记录的watcher让它去执行\r\n        }\r\n    })\r\n}\r\nexport function observe(data) {\r\n\r\n    if(typeof data !== 'object' || data === null) {\r\n        return\r\n    }\r\n    if(data.__ob__){ // 放置循环引用了\r\n        return;\r\n    }\r\n    return new Observer(data)\r\n}","import { observe } from \"./observer/index\";\r\n\r\nexport function initState(vm) {\r\n    const opts = vm.$options;\r\n    if(opts.data) {\r\n        initData(vm)\r\n    }\r\n}\r\n\r\nfunction proxy(target, source, key) {\r\n    Object.defineProperty(target, key, {\r\n        get() {\r\n            return target[source][key]\r\n        },\r\n        set(newValue) {\r\n            target[source][key] = newValue;\r\n        }\r\n    })\r\n}\r\n\r\n\r\nfunction initData(vm) {\r\n    let data = vm.$options.data;\r\n    data = vm._data = typeof data === 'function' ? data() : data;\r\n\r\n    for(let key in data) {\r\n        //将data上的数据挂载到vm上\r\n        proxy(vm, '_data', key);\r\n    }\r\n    observe(data);\r\n}\r\n\r\n","import { compileToFunctions } from \"./complier/index\";\r\nimport { callHook, mountComponent } from \"./lifecycle\";\r\nimport { initState } from \"./state\";\r\nimport { mergeOptions, nextTick } from \"./util\";\r\n\r\n\r\nexport function initMixin(Vue){\r\n    Vue.prototype._init = function(options) {\r\n        let vm = this;\r\n        vm.$options = mergeOptions(vm.constructor.options, options);\r\n        //初始化状态\r\n        callHook(vm,'beforeCreate');\r\n        initState(vm);\r\n        callHook(vm,'created');\r\n        if(vm.$options.el) {//获取要渲染的模板\r\n            this.$mounted(vm.$options.el)\r\n        }\r\n    }\r\n    Vue.prototype.$nextTick = nextTick\r\n    Vue.prototype.$mounted = function(el) {\r\n        el = document.querySelector(el);\r\n        const vm = this;\r\n        const options = vm.$options;\r\n        vm.$el = el;\r\n        // 获取render\r\n        if(!options.render) {\r\n            let template = options.template;\r\n            if(!template && el) {\r\n                template = el.outerHTML;\r\n            }\r\n            const render = compileToFunctions(template);\r\n            options.render = render\r\n        }\r\n\r\n        mountComponent(vm);\r\n        \r\n    }\r\n}\r\n\r\n","import { createElement, createTextVnode } from \"./vdom/index\"\r\n\r\nexport function renderMixin(Vue) {\r\n    Vue.prototype._c = function(...args) {\r\n        return createElement(this, ...args);\r\n    }\r\n    Vue.prototype._v = function(text) {\r\n        return createTextVnode(this, text);\r\n    }\r\n    Vue.prototype._s = function(val) {\r\n        return val == null ? \"\" : typeof val === 'object' ? JSON.stringify(val) : val\r\n    }\r\n    Vue.prototype._render = function() {\r\n        let vm = this;\r\n        let render = vm.$options.render;\r\n        let vnode = render.call(vm);\r\n        return vnode\r\n    }\r\n}","import { compileToFunctions } from \"./complier/index\";\r\nimport { initGlobalAPI } from \"./global-api/index\";\r\nimport { initMixin } from \"./init\";\r\nimport { lifecycleMixin } from \"./lifecycle\";\r\nimport { renderMixin } from \"./render\";\r\nimport { createElm, patch} from \"./vdom/patch\";\r\n\r\n\r\nfunction Vue(options) {\r\n    this._init(options)\r\n}\r\n\r\ninitMixin(Vue);\r\nlifecycleMixin(Vue);\r\nrenderMixin(Vue);\r\n\r\ninitGlobalAPI(Vue);\r\n\r\n\r\n// let vm1 = new Vue({\r\n//     data() {\r\n//         return {\r\n//             name: 'zf'\r\n//         }\r\n//     }\r\n// })\r\n\r\n// let render1 = compileToFunctions(`<ul>\r\n    \r\n//     <li key=\"E\">E</li>\r\n//     <li key=\"B\">B</li>\r\n//     <li key=\"A\">A</li>\r\n//     <li key=\"C\">C</li>\r\n//     <li key=\"D\">D</li>\r\n    \r\n// </ul>`);\r\n// let oldVnode = render1.call(vm1);\r\n// let el = createElm(oldVnode);\r\n// document.body.appendChild(el);\r\n\r\n\r\n// let vm2 = new Vue({\r\n//     data() {\r\n//         return {\r\n//             name: 'kinth'\r\n//         }\r\n//     }\r\n// })\r\n// let render2 = compileToFunctions(`<ul>\r\n// <li key=\"A\">A</li>\r\n// <li key=\"B\">B</li>\r\n// <li key=\"C\">C</li>\r\n// <li key=\"D\">D</li>\r\n// </ul>`);\r\n// let newVnode = render2.call(vm2);\r\n// setTimeout(() => {\r\n//     patch(oldVnode, newVnode); //  包括了初渲染和diff算法的流程\r\n// }, 4000);\r\n\r\nexport default Vue;"],"names":["defaultTagRE","genProps","attrs","str","i","length","attr","name","obj","value","split","forEach","item","key","JSON","stringify","slice","gen","node","type","generate","text","test","tokens","match","index","lastIndex","exec","push","trim","join","genChildren","el","children","map","child","code","tag","ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","parseHTML","html","root","currentParent","stack","createASTElement","parent","start","tagName","end","pop","Error","chars","replace","advance","n","substring","parseStartTag","textEnd","indexOf","startTagMatch","endTagMatch","compileToFunctions","template","ast","render","fn","Function","callbacks","waiting","flushCallbacks","callback","nextTick","cb","Promise","resolve","then","strats","LIFECYCLE_HOOKS","mergeHook","parentVal","childVal","concat","hook","components","res","Object","create","isObject","val","mergeOptions","options","mergeField","hasOwnProperty","makeUp","isReservedTag","initGlobalAPI","Vue","mixin","_base","component","id","definition","extend","cid","Super","Sub","VueComponent","_init","prototype","constructor","Dep","subs","depend","target","addDep","addSub","watcher","notify","update","pushTarget","popTarget","has","queue","pending","flushSchedularQueue","run","queueWatcher","Watcher","vm","exprOrFn","getter","deps","depsId","Set","get","dep","add","createElement","data","vnode","undefined","Ctor","$options","createComponent","init","componentInstance","componentOptions","$mounted","createTextVnode","isSameVnode","oldVnode","newVNode","patch","createElm","isRealElement","nodeType","oldElm","parentElm","parentNode","insertBefore","nextSibling","removeChild","parentElement","replaceChild","textContent","updateProperties","oldChildren","newChildren","updateChildren","innerHTML","appendChild","oldStartIndex","oldEndInex","oldStartVnode","oldEndVnode","newStartIndex","newEndIndex","newStartVnode","newEndVnode","makeIndexByKey","oldEndIndex","moveIndex","moveVnode","nextEle","$el","document","createTextNode","oldProps","newProps","removeAttribute","newStyle","style","oldStyle","styleName","className","class","setAttribute","lifecycleMixin","_update","prevVnode","_vnode","callHook","handlers","handler","call","mountComponent","updateComponent","_render","oldArrayMethods","Array","arrayMethods","methods","method","args","ob","__ob__","inserted","observeArray","Observer","defineProperty","configurable","enumerable","isArray","setPrototypeOf","walk","len","observe","keys","defineReactive","dependArray","current","childOb","set","newValue","initState","opts","initData","proxy","source","_data","initMixin","$nextTick","querySelector","outerHTML","renderMixin","_c","_v","_s"],"mappings":"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"}