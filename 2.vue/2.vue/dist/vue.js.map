{"version":3,"file":"vue.js","sources":["../src/complier/generate.js","../src/complier/parse.js","../src/complier/index.js","../src/observer/watcher.js","../src/vdom/patch.js","../src/lifecycle.js","../src/observer/array.js","../src/observer/index.js","../src/state.js","../src/init.js","../src/vdom/index.js","../src/render.js","../src/index.js"],"sourcesContent":["const defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g\r\n\r\nfunction genProps(attrs) {\r\n    let str = '';\r\n    for(let i = 0; i < attrs.length; i++) {\r\n        let attr = attrs[i];\r\n        if(attr.name==\"style\") {\r\n            let obj = {};\r\n            attr.value.split(';').forEach(item => {\r\n                if(item) {\r\n                    let [key, value] = item.split(':');\r\n                    obj[key] = value\r\n                }\r\n            });\r\n            attr.value = obj\r\n        }\r\n\r\n        str += `${attr.name}:${JSON.stringify(attr.value)},`\r\n    }\r\n    return `{${str.slice(0,-1)}}`\r\n}\r\nfunction gen(node) {\r\n    if(node.type == 1) {\r\n        return generate(node)\r\n    }else {\r\n        let text = node.text;\r\n        if(defaultTagRE.test(text)) {\r\n            let tokens = [];\r\n            let match ;\r\n            let index = 0;\r\n            let lastIndex = defaultTagRE.lastIndex = 0;\r\n            while(match = defaultTagRE.exec(text)){ // aa {{ age }} haha \r\n                index = match.index;\r\n                if(index >lastIndex){\r\n                    tokens.push(JSON.stringify(text.slice(lastIndex,index)));\r\n                }\r\n                tokens.push(`_s(${match[1].trim()})`);\r\n                lastIndex = index + match[0].length;\r\n            }\r\n            if(lastIndex < text.length){\r\n                tokens.push(JSON.stringify(text.slice(lastIndex)))\r\n            }\r\n            return  `_v(${tokens.join('+')})`\r\n        }else {\r\n            return `_v(${JSON.stringify(text)})`\r\n        }\r\n    }\r\n}\r\n\r\nfunction genChildren(el) {\r\n    const children  = el.children;\r\n    if(children){\r\n        return children.map(child=>gen(child)).join(',')\r\n    }\r\n}\r\nexport function generate(el) {\r\n    let children = genChildren(el);\r\n    let code = `_c('${el.tag}',${el.attrs.length!=0?genProps(el.attrs):'undefined'}${children?','+children:''})`;\r\n    return code;   \r\n}\r\n\r\n/**\r\n * 将字符串 转成可运行的js\r\n * <div id=\"app\" a=1 b =\"2\">\r\n *    hello \r\n *    <div style=\"color: red\">\r\n *         <span>! {{ name}} !</span>\r\n *    </div>\r\n * </div>\r\n * _c('div',{id:'app',a:1,b:'2'},\r\n *      _v(\"hello\"),\r\n *      _c('div', {style:{color: 'red}}, \r\n *          _c('span',undefined, \r\n *              _v('!' + _s(name) + '!')\r\n *          )\r\n *      )\r\n * )\r\n */","\r\nconst ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`; // aa-aa \r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`; //aa:aa\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // 可以匹配到标签名  [1]\r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); //[0] 标签的结束名字\r\n//    style=\"xxx\"   style='xxx'  style=xxx\r\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;\r\nconst startTagClose = /^\\s*(\\/?)>/;\r\n\r\n\r\nexport function parseHTML(html) {\r\n    let root;\r\n    let currentParent;\r\n    let stack = []\r\n\r\n\r\n    function createASTElement(tag, attrs) {\r\n        return {\r\n            tag,\r\n            attrs,\r\n            type: 1,\r\n            children: [],\r\n            parent: null\r\n        }\r\n\r\n    }\r\n\r\n\r\n    function start(tagName, attrs) {\r\n        let node = createASTElement(tagName, attrs);\r\n        if(root == null) {\r\n            root = node;\r\n        }\r\n        currentParent = node;\r\n        stack.push(node);\r\n    }\r\n\r\n    function end(tagName) {\r\n        let node = stack.pop();\r\n        if(node.tag != tagName) {\r\n            throw Error(\"解析报错\");\r\n        }\r\n\r\n        currentParent = stack[stack.length - 1];\r\n        if(currentParent) {\r\n            node.parent = currentParent;\r\n            currentParent.children.push(node);\r\n        }\r\n    }\r\n\r\n    function chars(text) {\r\n        text = text.replace(/\\s/g,\"\");\r\n        if(text) {\r\n            currentParent.children.push({\r\n                text,\r\n                type: 3\r\n            })\r\n        }\r\n    }\r\n\r\n    function advance(n) {\r\n        html = html.substring(n)\r\n    }\r\n\r\n    function parseStartTag() {\r\n        let start = html.match(startTagOpen);\r\n        if(start) {\r\n            let match = {\r\n                tagName: start[1],\r\n                attrs: []\r\n            }\r\n            advance(start[0].length);\r\n\r\n            let end, attr;\r\n            while(!(end=html.match(startTagClose)) && (attr = html.match(attribute))) {\r\n                match.attrs.push({\r\n                    name: attr[1],\r\n                    value: attr[3] || attr[4] || attr[5] || true\r\n                })\r\n                advance(attr[0].length)\r\n            }\r\n            if(end) {\r\n                advance(end[0].length)\r\n                return match\r\n            }\r\n            \r\n        }\r\n\r\n    }\r\n\r\n    while(html) {\r\n        let textEnd = html.indexOf(\"<\");\r\n        if(textEnd == 0) {//标签\r\n            let startTagMatch = parseStartTag();\r\n            if(startTagMatch) {\r\n                start(startTagMatch.tagName, startTagMatch.attrs)\r\n                continue\r\n            }\r\n\r\n            let endTagMatch = html.match(endTag);\r\n            if(endTagMatch) {\r\n                advance(endTagMatch[0].length);\r\n                end(endTagMatch[1]);\r\n                continue;\r\n            }\r\n\r\n\r\n        }\r\n        if(textEnd > 0) {//文本\r\n            let text = html.substring(0, textEnd);\r\n            advance(text.length);\r\n            chars(text);\r\n        }\r\n    }\r\n    return root;\r\n}","import { generate } from \"./generate.js\";\r\nimport { parseHTML } from \"./parse.js\";\r\nexport function compileToFunctions(template) {\r\n    //获取ast树\r\n    let ast = parseHTML(template);\r\n    \r\n    //获得可运行的render函数\r\n    let code = generate(ast);\r\n    let render = `with(this){return ${code}}`\r\n    let fn = new Function(render);\r\n    return fn\r\n}\r\n\r\n// function a(){\r\n//     with(this) {\r\n//         console.log(b)\r\n//     }\r\n// }\r\n// a.call({b:1}) // 1","\r\nlet id = 0;\r\nclass Watcher{\r\n    constructor(vm, exprOrFn, cb, options) {\r\n        this.vm = vm;\r\n        this.cb = cb;\r\n        this.options = options;\r\n        exprOrFn();\r\n    }\r\n}\r\n\r\nexport default Watcher;","export function patch(oldVnode, vnode) {\r\n    // oldVnode 是一个真实的元素\r\n    const isRealElement = oldVnode.nodeType\r\n    if (isRealElement) {\r\n        // 初次渲染\r\n        const oldElm = oldVnode; // id=\"app\"\r\n        const parentElm = oldElm.parentNode; // body\r\n        let el = createElm(vnode);\r\n        parentElm.insertBefore(el, oldElm.nextSibling); // 将创建的节点查到原有的节点的下一个\r\n        parentElm.removeChild(oldElm);\r\n        return el; // vm.$el\r\n    } else {\r\n        // diff算法\r\n    }\r\n}\r\n\r\nfunction createElm(vnode) { // 根据虚拟节点创建真实的节点\r\n    let { tag, children, key, data, text, vm } = vnode;\r\n    if(typeof tag === 'string'){\r\n        // 可能是组件\r\n        vnode.el =  document.createElement(tag); // 用vue的指令时 可以通过vnode拿到真实dom\r\n        updateProperties(vnode);\r\n        children.forEach(child=>{ // 如果有儿子节点，就进行递归操作\r\n           vnode.el.appendChild(createElm(child))\r\n        })\r\n    }else{\r\n        vnode.el = document.createTextNode(text)\r\n    }\r\n\r\n    return vnode.el;\r\n}\r\nfunction updateProperties(vnode){\r\n    let newProps = vnode.data || {}; // 属性\r\n    let el = vnode.el; // dom元素\r\n\r\n    for(let key in newProps){\r\n        if(key == 'style'){\r\n            for(let styleName in newProps.style){\r\n                el.style[styleName] = newProps.style[styleName]\r\n            }\r\n        }else if(key === 'class'){\r\n            el.className = newProps.class\r\n        }else{\r\n            el.setAttribute(key,newProps[key]);\r\n        }\r\n    }\r\n}","import Watcher from \"./observer/watcher\"\r\nimport {patch} from './vdom/patch'\r\n\r\nexport function lifecycleMixin(Vue) {\r\n    Vue.prototype._update = function(vnode) {\r\n        const vm = this;\r\n        vm.$el = patch(vm.$el, vnode);\r\n    }\r\n}\r\n\r\n//组件挂载\r\nexport function mountComponent(vm, el) {\r\n     // 默认vue是通过watcher来进行渲染  = 渲染watcher （每一个组件都有一个渲染watcher）\r\n    let updateComponent = () => {\r\n        let vnode = vm._render();//生成虚拟节点\r\n        vm._update(vnode);//将虚拟节点转为真实节点\r\n    }\r\n\r\n    new Watcher(vm, updateComponent, () => {}, true); // updateComponent();\r\n\r\n}","let oldArrayMethods = Array.prototype;\r\n\r\nexport let arrayMethods = Object.create(Array.prototype);\r\n\r\nlet methods = [\r\n    'push',\r\n    'pop',\r\n    'unshift',\r\n    'shift',\r\n    'splice',\r\n    'reserve',\r\n    'sort'\r\n]\r\n\r\nmethods.forEach(method=> {\r\n    arrayMethods[method] = function(...args) {\r\n        let res = oldArrayMethods[method].call(this, ...args);\r\n        \r\n        let ob = this.__ob__;\r\n        let inserted;\r\n        switch (method) {\r\n            case 'push':\r\n            case 'unshift':\r\n                inserted = args;    \r\n                break;\r\n            case 'splice':\r\n                inserted = args.slice(2)\r\n        }\r\n        // console.log(`调用了数组${method}方法`);\r\n        ob.observeArray(inserted);\r\n        \r\n        return res;\r\n    }\r\n})\r\n","import { arrayMethods } from \"./array\";\r\n\r\nclass Observer{\r\n    constructor(value) {\r\n        Object.defineProperty(value, \"__ob__\", {\r\n            configurable: false,\r\n            enumerable: false,\r\n            value: this,\r\n        })\r\n\r\n        if(Array.isArray(value)) {\r\n            //监听删除、添加、排序、反转元素的方法\r\n            Object.setPrototypeOf(value, arrayMethods)\r\n            this.observeArray(value);\r\n        }else{\r\n            this.walk(value);\r\n        }\r\n        \r\n    }\r\n\r\n    observeArray(value) {\r\n        for(let i = 0, len = value.length; i < len; i++) {\r\n            observe(value[i]);\r\n        }\r\n    }\r\n\r\n    walk(data) {\r\n        Object.keys(data).forEach(key=>{\r\n            defineReactive(data, key, data[key])\r\n        })\r\n    }\r\n}\r\n\r\n\r\nfunction defineReactive(data, key, value) {\r\n    observe(value);\r\n    Object.defineProperty(data, key, {\r\n        get() {\r\n            return value\r\n        },\r\n        set(newValue) {\r\n            if(newValue === value) return;\r\n            value = newValue;\r\n        }\r\n    })\r\n}\r\nexport function observe(data) {\r\n\r\n    if(typeof data !== 'object' || data === null) {\r\n        return\r\n    }\r\n\r\n    return new Observer(data)\r\n}","import { observe } from \"./observer/index\";\r\n\r\nexport function initState(vm) {\r\n    const opts = vm.$options;\r\n    if(opts.data) {\r\n        initData(vm)\r\n    }\r\n}\r\n\r\nfunction proxy(target, source, key) {\r\n    Object.defineProperty(target, key, {\r\n        get() {\r\n            return target[source][key]\r\n        },\r\n        set(newValue) {\r\n            target[source][key] = newValue;\r\n        }\r\n    })\r\n}\r\n\r\n\r\nfunction initData(vm) {\r\n    let data = vm.$options.data;\r\n    data = vm._data = typeof data === 'function' ? data() : data;\r\n\r\n    for(let key in data) {\r\n        //将data上的数据挂载到vm上\r\n        proxy(vm, '_data', key);\r\n    }\r\n    observe(data);\r\n}\r\n\r\n","import { compileToFunctions } from \"./complier/index\";\r\nimport { mountComponent } from \"./lifecycle\";\r\nimport { initState } from \"./state\";\r\n\r\n\r\nexport function initMixin(Vue){\r\n    Vue.prototype._init = function(options) {\r\n        let vm = this;\r\n        vm.$options = options;\r\n        //初始化状态\r\n        initState(vm);\r\n\r\n        if(vm.$options.el) {//获取要渲染的模板\r\n            this.$mounted(vm.$options.el)\r\n        }\r\n    }\r\n\r\n    Vue.prototype.$mounted = function(el) {\r\n        el = document.querySelector(el);\r\n        const vm = this;\r\n        const options = vm.$options;\r\n        vm.$el = el;\r\n        // 获取render\r\n        if(!options.render) {\r\n            let template = options.template;\r\n            if(!template && el) {\r\n                template = el.outerHTML;\r\n            }\r\n            const render = compileToFunctions(template);\r\n            options.render = render\r\n        }\r\n\r\n        mountComponent(vm, el);\r\n        \r\n    }\r\n}\r\n\r\n","//创建虚拟节点\r\nexport function createElement(vm, tag, data={}, ...children){\r\n    return vnode(vm,tag,data, data.key,children, undefined)\r\n}\r\n\r\nexport function createTextVnode(vm, text) {\r\n    return vnode(vm, undefined, undefined, undefined, undefined, text)\r\n}\r\n\r\n\r\nfunction vnode(vm, tag, data, key,children, text) {\r\n    return {\r\n        vm, \r\n        tag,\r\n        data,\r\n        key,\r\n        children,\r\n        text\r\n    }\r\n}","import { createElement, createTextVnode } from \"./vdom/index\"\r\n\r\nexport function renderMixin(Vue) {\r\n    Vue.prototype._c = function(...args) {\r\n        return createElement(this, ...args);\r\n    }\r\n    Vue.prototype._v = function(text) {\r\n        return createTextVnode(this, text);\r\n    }\r\n    Vue.prototype._s = function(val) {\r\n        return val == null ? \"\" : typeof val === 'object' ? JSON.stringify(val) : val\r\n    }\r\n    Vue.prototype._render = function() {\r\n        let vm = this;\r\n        let render = vm.$options.render;\r\n        let vnode = render.call(vm);\r\n        return vnode\r\n    }\r\n}","import { initMixin } from \"./init\";\r\nimport { lifecycleMixin } from \"./lifecycle\";\r\nimport { renderMixin } from \"./render\";\r\n\r\n\r\nfunction Vue(options) {\r\n    this._init(options)\r\n}\r\n\r\ninitMixin(Vue);\r\nlifecycleMixin(Vue);\r\nrenderMixin(Vue);\r\n\r\nexport default Vue;"],"names":["defaultTagRE","genProps","attrs","str","i","length","attr","name","obj","value","split","forEach","item","key","JSON","stringify","slice","gen","node","type","generate","text","test","tokens","match","index","lastIndex","exec","push","trim","join","genChildren","el","children","map","child","code","tag","ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","parseHTML","html","root","currentParent","stack","createASTElement","parent","start","tagName","end","pop","Error","chars","replace","advance","n","substring","parseStartTag","textEnd","indexOf","startTagMatch","endTagMatch","compileToFunctions","template","ast","render","fn","Function","Watcher","constructor","vm","exprOrFn","cb","options","patch","oldVnode","vnode","isRealElement","nodeType","oldElm","parentElm","parentNode","createElm","insertBefore","nextSibling","removeChild","data","document","createElement","updateProperties","appendChild","createTextNode","newProps","styleName","style","className","class","setAttribute","lifecycleMixin","Vue","prototype","_update","$el","mountComponent","updateComponent","_render","oldArrayMethods","Array","arrayMethods","Object","create","methods","method","args","res","call","ob","__ob__","inserted","observeArray","Observer","defineProperty","configurable","enumerable","isArray","setPrototypeOf","walk","len","observe","keys","defineReactive","get","set","newValue","initState","opts","$options","initData","proxy","target","source","_data","initMixin","_init","$mounted","querySelector","outerHTML","undefined","createTextVnode","renderMixin","_c","_v","_s","val"],"mappings":"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"}