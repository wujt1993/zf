{"version":3,"file":"vue.js","sources":["../src/observer/array.js","../src/observer/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["let oldArrayProtoMethods = Array.prototype;\r\n\r\nexport let arrayMethods = Object.create(Array.prototype);\r\n\r\nlet methods = [\r\n    'push',\r\n    'pop',\r\n    'unshift',\r\n    'shift',\r\n    'splice',\r\n    'reserve',\r\n    'sort'\r\n]\r\n\r\n\r\nmethods.forEach(method=>{\r\n    arrayMethods[method] = function(...args) {\r\n        let res = oldArrayProtoMethods[method].call(this, ...args);\r\n        console.log(`调用了数组${method}方法`);\r\n        return res\r\n    }\r\n})","\r\nimport {arrayMethods} from  './array.js'\r\n\r\nclass Observer{\r\n    constructor(value) {\r\n        //需要对数据进行重新定义\r\n        //当value为数组时，并不对每个元素进行defineProperty\r\n        //当数组长度发生变化时，监听数组数据：push、pop、unshift、shift、splice、reserve、 sort\r\n        if(Array.isArray(value)) {\r\n            Object.setPrototypeOf(value,arrayMethods);\r\n            this.observeArray(value); \r\n        }else{\r\n            this.walk(value)\r\n        }\r\n        \r\n    }\r\n\r\n    observeArray(value) {\r\n        for(let i = 0, length = value.length; i < length; i++) {\r\n            observe(value[i])\r\n        }\r\n    }\r\n    walk(data) {\r\n        Object.keys(data).forEach(key => {\r\n            defineReactive(data, key, data[key])\r\n        });\r\n    }\r\n}\r\n\r\nexport function defineReactive(data, key, value) {\r\n    //如果value 也是个object对象，需要递归检测\r\n    observe(value)\r\n\r\n\r\n    Object.defineProperty(data, key, {\r\n        get() {\r\n            return value;\r\n        },\r\n        set(newValue) {\r\n            if(newValue === value) return \r\n            //如果赋值为object对象,需要检测数据\r\n            observe(newValue)\r\n            value = newValue \r\n        }\r\n    })\r\n}\r\n\r\n//检测数据\r\nexport function observe(data){\r\n    //只能对对象类型进行观测\r\n    if(typeof data !== 'object' || data === null) {\r\n        return \r\n    }\r\n    //通过类对数据进行观测\r\n    return new Observer(data)\r\n}","import { observe } from \"./observer/index.js\";\r\n\r\n//初始化状态\r\nexport function initState(vm) {\r\n    //将所有配置信息挂载在vm上，以便后续数据视图更新\r\n    const opts = vm.$options;\r\n    \r\n    if(opts.data) { //初始化数据\r\n        initData(vm)\r\n    }\r\n}\r\n\r\nfunction proxy(target, source, key) {\r\n    Object.defineProperty(target, key, {\r\n        get() {\r\n            return target[source][key]\r\n        },\r\n        set(newValue) {\r\n            target[source][key] = newValue;\r\n        }\r\n    })\r\n}\r\n\r\nfunction initData(vm) {\r\n    // 获取 用户数据\r\n    let data = vm.$options.data;\r\n\r\n    \r\n    data = vm._data = typeof data === 'function' ? data.call(vm) : data;\r\n    \r\n    // 数据劫持，将_data 属性上的所有值初始化到vm上\r\n    for(let key in data) {\r\n        proxy(vm, '_data', key)\r\n    }\r\n\r\n    //检测数据\r\n    observe(data);\r\n    \r\n}","import { initState } from \"./state\";\r\n\r\n//初始化参数\r\nexport function initMixin(Vue){\r\n    Vue.prototype._init = function(options) {\r\n        // vue 可以通过$options 获取配置信息\r\n        let vm = this;\r\n        vm.$options = options;\r\n\r\n        //初始化状态\r\n        initState(vm);\r\n\r\n    }\r\n}","import { initMixin } from \"./init\";\r\n\r\nfunction Vue(options) {\r\n    this._init(options)\r\n}\r\n\r\ninitMixin(Vue);\r\n\r\nexport default Vue;"],"names":["oldArrayProtoMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","args","res","call","console","log","Observer","value","isArray","setPrototypeOf","observeArray","walk","i","length","observe","data","keys","key","defineReactive","defineProperty","get","set","newValue","initState","vm","opts","$options","initData","proxy","target","source","_data","initMixin","Vue","_init","options"],"mappings":"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"}