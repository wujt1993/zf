{"version":3,"file":"vue.js","sources":["../src/compiler/parse.js","../src/compiler/index.js","../src/util/index.js","../src/observer/array.js","../src/observer/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["const ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`;  \r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`;\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // 标签开头的正则 捕获的内容是标签名\r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 匹配标签结尾的 </div>\r\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/; // 匹配属性的\r\nconst startTagClose = /^\\s*(\\/?)>/; // 匹配标签结束的 >\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g; //{{name}}\r\n\r\n\r\nfunction start(tagName, attrs) {\r\n    console.log('start:',tagName, attrs)\r\n}\r\nfunction chars(text) {\r\n    console.log('chars:',text)\r\n}\r\nfunction end(tagName) {\r\n    console.log('end:',tagName)\r\n}\r\nexport function parseHTML(html) {\r\n    while(html) {\r\n        let textEnd = html.indexOf(\"<\");\r\n        if(textEnd == 0) {\r\n            let startTagMatch = parseStartTag(); // 获取开始标签的标签名及属性\r\n            if(startTagMatch) {\r\n                start(startTagMatch.tagName, startTagMatch.attrs);\r\n                continue;\r\n            }\r\n            let endTagMatch = html.match(endTag);\r\n            if (endTagMatch) {\r\n                end(endTagMatch[1])\r\n                advance(endTagMatch[0].length);\r\n                continue\r\n            }\r\n            \r\n        }\r\n        if(textEnd > 0){\r\n            let text = html.substring(0, textEnd);\r\n            advance(text.length);\r\n            chars(text); // 3解析文本\r\n        }\r\n\r\n\r\n\r\n    }\r\n\r\n    function advance(n) {\r\n        html = html.substring(n);\r\n    }\r\n\r\n    function parseStartTag() {\r\n        let start = html.match(startTagOpen);\r\n        if(start) {\r\n            const match = {\r\n                tagName: start[1],\r\n                attrs: []\r\n            }\r\n            advance(start[0].length); //// 将标签删除\r\n            let end, attr;// 标签结束符 、 属性\r\n            while(!(end = html.match(startTagClose)) && (attr = html.match(attribute))) {\r\n                match.attrs.push({\r\n                    name: attr[1],\r\n                    value: attr[3] || attr[4] || attr[5]\r\n                })\r\n                advance(attr[0].length)\r\n            }\r\n            if (end) { // 去掉开始标签的 >\r\n                advance(end[0].length);\r\n                return match;\r\n            }\r\n        }\r\n    }\r\n}","\r\nimport {parseHTML} from './parse.js'\r\n\r\n\r\nexport function compilerToFunctions(template) {\r\n    //解析html树：将HTML -> ast 语法树\r\n    let root = parseHTML(template) \r\n}","\r\nexport function isObject(data) {\r\n    return typeof data === 'object' && data !== null;\r\n}\r\n\r\nexport function proxy(vm,source,key){\r\n    Object.defineProperty(vm, key, {\r\n        get() {\r\n            return data[source][key]\r\n        },\r\n        set(newValue) {\r\n            data[source][key] = newValue\r\n        }\r\n    })\r\n}","\r\nlet oldArrayMethods = Array.prototype;\r\nexport const arrayMethods = Object.create(oldArrayMethods);\r\n\r\nlet methods = [\r\n    'push',\r\n    'pop',\r\n    'unshift',\r\n    'shift',\r\n    'splice',\r\n    'sort',\r\n    'reserve'\r\n];\r\n\r\nmethods.forEach(method => {\r\n    arrayMethods[method] = function(...args) {\r\n        const result = oldArrayMethods[method].apply(this, args);\r\n        let ob = this.__ob__;\r\n        let inserted;\r\n        switch (method) {\r\n            case \"push\":\r\n            case \"unshift\":\r\n                inserted = args\r\n                break;\r\n            case 'splice':\r\n                inserted = args.slice(2);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        if(inserted) ob.observeArray(inserted)\r\n        return result;\r\n    }\r\n});\r\n","import { isObject } from \"../util/index.js\";\r\nimport {arrayMethods} from \"./array.js\"\r\n\r\nclass Observer {\r\n    constructor(value) {\r\n        //添加__ob__属性，用于对象挂载本身，且不能被枚举遍历\r\n        Object.defineProperty(value, '__ob__', {\r\n            enumerable: false,\r\n            configurable: false,\r\n            value: this\r\n        })\r\n        if(Array.isArray(value)) {\r\n            value.__proto__ = arrayMethods;//对改变数组长度及改变数组排序的方法进行劫持\r\n            this.observeArray(value);//对每个元素进行数据劫持\r\n        }else{\r\n            this.walk(value);//对象 \r\n        }\r\n    }\r\n\r\n    observeArray(data) {\r\n        data.forEach(item => {\r\n            observe(item);\r\n        })\r\n    }\r\n\r\n    walk(data) {\r\n        let keys = Object.keys(data)\r\n        keys.forEach( key=> {\r\n            defineReactive(data, key, data[key])\r\n        })\r\n    }\r\n}\r\n\r\n\r\nfunction defineReactive(data, key, value) {\r\n    observe(value);\r\n    Object.defineProperty(data, key, {\r\n        get() {\r\n            return value\r\n        },\r\n        set(newValue) {\r\n            if(value == newValue);\r\n            observe(newValue);\r\n            value = newValue;\r\n            \r\n        }\r\n    })\r\n}\r\n\r\nexport function observe(data) {\r\n    if(!isObject(data)) return; \r\n    new Observer(data);\r\n}","import {observe} from './observer/index.js'\r\nimport {proxy} from './util/index.js'\r\n\r\nexport function initState(vm) {\r\n    // vue的数据来源 属性 方法 数据 计算属性 watch\r\n    const opts = vm.$options;\r\n\r\n    if(opts.props) {\r\n        initProps(vm)\r\n    }\r\n    if(opts.methods) {\r\n        initMethods(vm)\r\n    }\r\n    if(opts.data) {\r\n        initData(vm)\r\n    }\r\n    if(opts.computed) {\r\n        initComputed(vm)\r\n    }\r\n    if(opts.watch) {\r\n        initWatch(vm)\r\n    }\r\n}\r\n\r\nfunction initProps() {}\r\nfunction initMethods() {}\r\nfunction initData(vm) {\r\n    let data = vm.$options.data;\r\n    data = vm._data = typeof data === 'function' ? data() : data;\r\n\r\n    //将_data上的数据代理给vm，以便用户使用\r\n    for(let key in data) {\r\n        proxy(vm, '_data', key);\r\n    }\r\n\r\n    //数据响应式处理(Object.definePrototype)\r\n    observe(data)\r\n}\r\nfunction initComputed() {}\r\nfunction initWatch() {}","import { compilerToFunctions } from './compiler/index.js';\r\nimport {initState} from './state'\r\nexport function initMixin(Vue) {\r\n\r\n    Vue.prototype._init = function(options) {\r\n        const vm = this;\r\n        vm.$options = options;//将配置信息挂载子Vue实例的$options 上\r\n        //初始化状态\r\n        initState(vm);\r\n\r\n        //页面挂载\r\n        if(vm.$options.el) {\r\n            vm.$mount(vm.$options.el)\r\n        }\r\n    }\r\n\r\n    Vue.prototype.$mount = function(el) {\r\n        const vm = this;\r\n        const options = vm.$options;\r\n        el = document.querySelector(el);\r\n        if(!options.render) {\r\n            let template = options.template;\r\n            \r\n            if(!template && el) {\r\n                template = el.outerHTML;\r\n            }\r\n            //将template 转成render\r\n            const render = compilerToFunctions(template)\r\n        }\r\n    }\r\n}","\r\nimport {initMixin} from './init.js'\r\n\r\nfunction Vue(options) {\r\n\r\n    //初始化vue\r\n    this._init(options);\r\n}\r\n\r\ninitMixin(Vue); //给原型上添加_init方法，初始化vue\r\n\r\n//导出Vue构造函数\r\nexport default Vue;"],"names":["ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","start","tagName","attrs","console","log","chars","text","end","parseHTML","html","textEnd","indexOf","startTagMatch","parseStartTag","endTagMatch","match","advance","length","substring","n","attr","push","name","value","compilerToFunctions","template","root","isObject","data","proxy","vm","source","key","Object","defineProperty","get","set","newValue","oldArrayMethods","Array","prototype","arrayMethods","create","methods","forEach","method","args","result","apply","ob","__ob__","inserted","slice","observeArray","Observer","enumerable","configurable","isArray","__proto__","walk","item","observe","keys","defineReactive","initState","opts","$options","props","initData","computed","watch","_data","initMixin","Vue","_init","options","el","$mount","document","querySelector","render","outerHTML"],"mappings":"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"}